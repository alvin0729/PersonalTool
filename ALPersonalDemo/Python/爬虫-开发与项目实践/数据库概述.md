##æ•°æ®åº“æ¦‚è¿°##

â€ƒâ€ƒæ•°æ®åº“æ˜¯å­˜å‚¨æ•°æ®çš„ä»“åº“å³æ•°æ®çš„é›†æ•£åœ°ï¼ŒAppå¦‚æœæœ‰å¤§é‡çš„æ•°æ®éœ€è¦è¿›è¡Œæœ¬åœ°å­˜å‚¨å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨æ•°æ®åº“æŠ€æœ¯ï¼Œå®ƒä¸ä»…èƒ½å¤Ÿæœ‰æ•ˆçš„å­˜å‚¨å’Œç®¡ç†æ•°æ®ï¼Œæ›´é‡è¦çš„æ˜¯æä¾›äº†æ–¹ä¾¿çš„æ£€ç´¢æ•°æ®çš„æ‰‹æ®µã€‚ç®€å•çš„è¯´ï¼Œæ•°æ®åº“æ˜¯å®ç°æ•°æ®æŒä¹…åŒ–çš„é‡è¦æ–¹æ¡ˆï¼Œå…¶ä»–çš„æ–¹æ¡ˆåŒ…æ‹¬ï¼šplistæ–‡ä»¶ã€archieveå½’æ¡£ã€NSUserDefaultsã€æ™®é€šæ–‡ä»¶ç­‰ã€‚
â€ƒâ€ƒç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ•°æ®åº“é‡‡ç”¨äº†å…³ç³»æ¨¡å‹ï¼Œä¹Ÿç§°ä¹‹ä¸ºå…³ç³»å‹æ•°æ®åº“ï¼Œå…³ç³»å‹æ•°æ®åº“çš„ç†è®ºåŸºç¡€æ˜¯å…³ç³»ä»£æ•°ï¼Œåœ¨å®ç°ä¸Šé€šè¿‡äºŒç»´è¡¨æ¥ç»„ç»‡æ•°æ®ã€‚

###å¸¸è§å…³ç³»å‹æ•°æ®åº“äº§å“###

- Oracleï¼šç”²éª¨æ–‡å…¬å¸çš„å¤§å‹å…³ç³»æ•°æ®åº“ç³»ç»Ÿï¼ŒåŠŸèƒ½å®Œå–„å®‰å…¨æ€§å¥½ï¼Œæ”¯æŒå•†ä¸šæ™ºèƒ½
- DB2ï¼šIBMå…¬å¸çš„äº§å“ï¼Œæ•°æ®ä»“åº“å’Œæ•°æ®æŒ–æ˜åŠŸèƒ½éå¸¸å¼ºå¤§
- SQLServerï¼šå¾®è½¯çš„äº§å“ï¼Œé€‚åˆå¾®è½¯è‡ªå·±çš„WindowsæœåŠ¡å™¨ç¯å¢ƒ
- MySQLï¼šå¼€æºçš„æ•°æ®åº“äº§å“ï¼Œä¸­å°å‹ç«™ç‚¹çš„æ•°æ®åº“æœåŠ¡å™¨é¦–é€‰


###ç›¸å…³æ¦‚å¿µ###

- è¡¨ï¼šå…³ç³»å‹æ•°æ®åº“é€šè¿‡äºŒç»´è¡¨ç»„ç»‡æ•°æ®
- è¡Œï¼šè¡¨æ ¼ä¸­çš„ä¸€è¡Œä»£è¡¨ä¸€æ¡è®°å½•
- åˆ—ï¼šè¡¨æ ¼ä¸­çš„ä¸€åˆ—æ˜¯ä¸€ä¸ªå­—æ®µï¼ˆå±æ€§ï¼‰
- ä¸»é”®ï¼šå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•
- å¤–é”®ï¼šå…¶ä»–è¡¨çš„ä¸»é”®ï¼Œå®ç°å‚ç…§å®Œæ•´æ€§
- æ•°æ®å®Œæ•´æ€§ï¼šå®ä½“å®Œæ•´æ€§ã€åŸŸå®Œæ•´æ€§å’Œå‚ç…§å®Œæ•´æ€§

##SQLiteå…¥é—¨##

â€ƒâ€ƒ[å®˜æ–¹ç½‘ç«™](http://www.sqlite.org)

â€ƒâ€ƒSQLiteæ˜¯å‡ ä¹æ‰€æœ‰ç§»åŠ¨æ“ä½œç³»ç»Ÿçš„æ ‡å‡†æ•°æ®åº“(äº‹å®æ ‡å‡†)ï¼Œå±äºåµŒå…¥å¼æ•°æ®åº“ç³»ç»Ÿã€‚

â€ƒâ€ƒå¯åŠ¨SQLiteï¼šåœ¨ç»ˆç«¯é”®å…¥sqlite3ï¼Œæç¤ºç¬¦å˜æˆsqlite>

â€ƒâ€ƒå¸¸ç”¨å‘½ä»¤ï¼š

	.help --- æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	.quit/.exit --- é€€å‡º
	.open --- æ‰“å¼€æŒ‡å®šçš„æ•°æ®åº“æ–‡ä»¶
	.save --- å°†å†…å­˜ä¸­çš„æ•°æ®åº“ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶
	.databases --- æ˜¾ç¤ºæ•°æ®åº“çš„ä¿¡æ¯
	.schema ?TABLE? --- æ˜¾ç¤ºè¡¨ç»“æ„
	.tables ?PATTERN? --- æ˜¾ç¤ºæ‰€æœ‰çš„è¡¨
	.mode MODE --- è®¾ç½®è¾“å‡ºæ¨¡å¼
	.stats ON|OFF --- å¼€å¯æˆ–å…³é—­ç»Ÿè®¡ä¿¡æ¯
	.dump ?TABLE?--- ä»¥SQLæ–‡æœ¬æ ¼å¼è½¬å­˜æ•°æ®åº“

##SQLç®€ä»‹##

â€ƒâ€ƒSQLå…¨ç§°ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯æ•°æ®åº“çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥åˆ†ä¸ºDDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰ã€DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰ã€DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰å’ŒDCLï¼ˆæ•°æ®æ§åˆ¶è¯­è¨€ï¼‰ã€‚

- DDL: createã€dropã€alter
- DML: insertã€deleteã€update
- DQL: select
- DCL: grantã€revoke

â€ƒâ€ƒä¾‹å­ï¼šåˆ›å»ºä¸€å¼ éƒ¨é—¨è¡¨å’Œä¸€å¼ å‘˜å·¥è¡¨ï¼Œå®Œæˆä¸‹é¢çš„æŸ¥è¯¢ã€‚

```SQL
create table TbDept
(
deptno tinyint primary key,
dname varchar(10) not null,
dloc varchar(20) not null
);

insert into TbDept values (10, 'ä¼šè®¡éƒ¨', 'åŒ—äº¬');
insert into TbDept values (20, 'ç ”å‘éƒ¨', 'æˆéƒ½');
insert into TbDept values (30, 'é”€å”®éƒ¨', 'é‡åº†');
insert into TbDept values (40, 'è¿ç»´éƒ¨', 'æ·±åœ³');

create table TbEmp
(
empno int primary key,
ename varchar(20) not null,
job varchar(10) not null,
mgr int,
sal int not null,
dno tinyint,
foreign key (dno) references TbDept(deptno)
);

insert into TbEmp values (7800, 'å¼ ä¸‰ä¸°', 'æ€»è£', null, 9000, 20);
insert into TbEmp values (2056, 'ä¹”å³°', 'åˆ†æå¸ˆ', 7800, 5000, 20);
insert into TbEmp values (3088, 'æè«æ„', 'è®¾è®¡å¸ˆ', 2056, 3500, 20);
insert into TbEmp values (3211, 'å¼ æ— å¿Œ', 'ç¨‹åºå‘˜', 2056, 3200, 20);
insert into TbEmp values (3233, 'ä¸˜å¤„æœº', 'ç¨‹åºå‘˜', 2056, 3400, 20);
insert into TbEmp values (3251, 'å¼ ç¿ å±±', 'ç¨‹åºå‘˜', 2056, 4000, 20);
insert into TbEmp values (5566, 'å®‹è¿œæ¡¥', 'ä¼šè®¡å¸ˆ', 7800, 4000, 10);
insert into TbEmp values (5234, 'éƒ­é–', 'å‡ºçº³', 5566, 2000, 10);
insert into TbEmp values (3344, 'é»„è“‰', 'é”€å”®ä¸»ç®¡', 7800, 3000, 30);
insert into TbEmp values (1359, 'èƒ¡ä¸€åˆ€', 'é”€å”®å‘˜', 3344, 1800, 30);
insert into TbEmp values (4466, 'è‹—äººå‡¤', 'é”€å”®å‘˜', 3344, 2500, 30);
insert into TbEmp values (3244, 'æ¬§é˜³é”‹', 'ç¨‹åºå‘˜', 3088, 3200, 20);
insert into TbEmp values (3577, 'æ¨è¿‡', 'ä¼šè®¡', 5566, 2200, 10);
insert into TbEmp values (3588, 'æœ±ä¹çœŸ', 'ä¼šè®¡', 5566, 2500, 10);
```

â€ƒâ€ƒSQLç»ƒä¹ ï¼š

0. æŸ¥è¯¢æœ€é«˜å·¥èµ„åŠå…¶å¯¹åº”å‘˜å·¥

   ```SQL
   select ename, sal from TbEmp where sal=(select max(sal) from TbEmp);
   ```

1. è®¡ç®—æ¯ä½å‘˜å·¥çš„å¹´è–ª

  ```SQL
  select ename, sal*12 as annSal from TbEmp;
  ```

2. ç»Ÿè®¡æœ‰å‘˜å·¥çš„éƒ¨é—¨çš„äººæ•°

  ```SQL
  select dno, count(dno) from TbEmp group by dno;
  ```

3. æ±‚æŒ£æœ€é«˜è–ªæ°´çš„å‘˜å·¥(bossé™¤å¤–)çš„å§“å

  ```SQL
  select ename, sal from TbEmp where sal=(select max(sal) from TbEmp where mgr is not null);
  ```

4. æŸ¥è¯¢è–ªæ°´è¶…è¿‡å¹³å‡è–ªæ°´çš„å‘˜å·¥çš„å§“åå’Œå·¥èµ„

    ```SQL
    select ename,sal from tbemp where sal >(select avg(sal) from tbemp);
    ```

5. æŸ¥è¯¢è–ªæ°´è¶…è¿‡å…¶æ‰€åœ¨éƒ¨é—¨å¹³å‡è–ªæ°´çš„å‘˜å·¥çš„å§“åã€éƒ¨é—¨ç¼–å·å’Œå·¥èµ„

  ```SQL
  select ename, sal, t1.dno from TbEmp as t1,
  (select dno, avg(sal) as avgSal from TbEmp group by dno) as t2 where 	t1.dno=t2.dno and t1.sal>t2.avgSal;

  select ename, sal, t1.dno from TbEmp as t1 inner join
  (select dno, avg(sal) as avgSal from TbEmp group by dno) as t2 on 
  t1.dno=t2.dno and t1.sal>t2.avgSal;
    
    select ename,t1.dno,sal from tbemp as t1 inner join (select dno,avg(sal) as avgSal from tbemp group by dno) as t2 on t1.dno = t2.dno and sal >avgSal;
  ```

6. æŸ¥è¯¢éƒ¨é—¨ä¸­è–ªæ°´æœ€é«˜çš„äººå§“åã€å·¥èµ„å’Œæ‰€åœ¨éƒ¨é—¨åç§°
     ```SQL
     select ename ,sal ,dname from (select ename,sal ,t1.dno from tbemp as t1 inner join(select dno ,max(sal) as maxSal from tbemp group by dno) as t2 on t1.dno = t2.dno and sal = maxSal) as t3 inner join tbdept as t4 where dno = deptno;
     ```

7. å“ªäº›äººæ˜¯ä¸»ç®¡

  ```SQL
  select ename, job from TbEmp where empno in (select distinct mgr from TbEmp where mgr is not null);
    select ename from tbemp where empno in(select distinct mgr from tbemp where mgr is not null)ï¼›
  ```
    >intersect äº¤é›†
    >  unionå¹¶é›†
    >  inuså·®é›†
    >  in
    >  å»é‡å’Œé›†åˆè¿ç®—
8. æ±‚å¹³å‡è–ªæ°´æœ€é«˜çš„éƒ¨é—¨çš„åç§°å’Œå¹³å‡å·¥èµ„

    ```SQL
     select dname,maxSal from (select dno,max(avgSal) as maxSal from(select dno,avg(sal) as avgSal from tbemp group by dno)) as t1 inner join tbdept as t2 on t1.dno = t2.deptno;
    ```

9. æ±‚è–ªæ°´æœ€é«˜çš„å‰3åé›‡å‘˜

  ```SQL
  select ename, sal from TbEmp order by sal desc limit 3;
  ```

10. æ±‚è–ªæ°´æ’åœ¨ç¬¬4-6åé›‡å‘˜

  ```SQL
  select ename, sal from TbEmp order by sal desc limit 3 offset 3;
    select * FROM tbemp order by sal desc limit 3,3;
  ```

11. æ±‚è–ªæ°´æœ€ä½çš„éƒ¨é—¨ç»ç†æ‰€åœ¨éƒ¨é—¨çš„åç§°
    ```SQL
    select dname,ename,minSal from (select dno,ename,min(sal) as minSal from tbemp where empno in(select DISTINCT mgr from tbemp where mgr is not null)) as t1 inner join tbdept as t2 on t1.dno = t2.deptno;
    ```

##FMDBçš„ä½¿ç”¨##

â€ƒâ€ƒ[FMDBä¸‹è½½åœ°å€](https://github.com/ccgus/fmdb)

â€ƒâ€ƒå®˜æ–¹æä¾›çš„å¯¹SQLiteçš„æ“ä½œéƒ½æ˜¯æ¯”è¾ƒåº•å±‚çš„Cå‡½æ•°ï¼Œç”¨èµ·æ¥ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ã€‚FMDBå¯¹è¿™äº›åº•å±‚çš„ä¸œè¥¿è¿›è¡Œäº†é¢å‘å¯¹è±¡çš„å°è£…ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æ·»åŠ è‹¹æœæä¾›çš„ä¾èµ–åº“libsqlite3.dylibã€‚

â€ƒâ€ƒFMDBçš„æ ¸å¿ƒAPIï¼š
â€‹	
	FMDatabase --- ä»£è¡¨æ•°æ®åº“
	FMResultSet --- ä»£è¡¨æ“ä½œæŸ¥è¯¢ç»“æœçš„æ¸¸æ ‡
	FMDatabaseAdditions --- å¯¹FMDatabaseç±»æ‰©å±•çš„Category
	FMDatabasePool --- æ•°æ®åº“è¿æ¥æ± æ”¯æŒç±»
	FMDatabaseQueue --- æ•°æ®åº“å¤šçº¿ç¨‹æ“ä½œæ”¯æŒç±»

```Objective-C
// åˆ›å»ºæ•°æ®åº“
- (void) createDb {
    NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/test.db"];
    NSLog(@"%@", path);
    self.db = [[FMDatabase alloc] initWithPath:path];
    if([self.db open]) {
        [self createTable];
    }
    else {
        NSLog(@"åˆ›å»ºæ•°æ®åº“å¤±è´¥!");
    }
}

// åˆ›å»ºè¡¨
- (void) createTable {
    NSString *sql = @"create table if not exists tb_user (username varchar(20) primary key, password varchar(20) not null, email varchar(50));";
    if([self.db executeUpdate:sql]) {
        [self insertData];
    }
    else {
        NSLog(@"åˆ›å»ºç”¨æˆ·è¡¨å¤±è´¥!");
    }
}

// æ’å…¥æ•°æ®
- (void) insertData {
    NSString *sql = @"insert into tb_user values (?,?,?);";
    if([self.db executeUpdate:sql, @"jackfrued", @"123456", @"jackfrued@126.com"]) {
        
    }
    else {
        NSLog(@"æ’å…¥æ•°æ®å¤±è´¥!");
    }
}

// æ˜¾ç¤ºè¡¨ä¸­çš„è®°å½•
- (void) showRecords {
    NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/test.db"];
    self.db = [[FMDatabase alloc] initWithPath:path];
    if([self.db open]) {
        NSString *sql = @"select * from tb_user";
        FMResultSet *rs = [self.db executeQuery:sql];
        NSLog(@"%d", rs.next);
        while([rs next]) {
            NSLog(@"Username: %@", [rs stringForColumn:@"username"]);
            NSLog(@"Password: %@", [rs stringForColumn:@"password"]);
            NSLog(@"Email: %@", [rs stringForColumn:@"email"]);
        }
        
        [self clearData];
    }
    else {
        NSLog(@"åˆ›å»ºæ•°æ®åº“å¤±è´¥!");
    }
}

- (void) clearData {
    NSString *sql = @"delete from tb_user";
    if([self.db executeUpdate:sql]) {
        NSLog(@"æ¸…ç†æ•°æ®æˆåŠŸ!!!");
    }
}
```
--------------------------------------------------
##ğŸ’ƒğŸ»æ•°æ®åº“
 - æ•°æ®åº“: æ•°æ®çš„é›†æ•£åœ°ï¼Œæœ‰æ•ˆçš„å­˜å‚¨å’Œç®¡ç†æ•°æ®
 - å…³ç³»å‹æ•°æ®åº“ï¼š1. ç”¨äºŒç»´è¡¨ç»„ç»‡æ•°æ®; 2. ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€(SQL - Structured Query Language)

```
è¡Œï¼šä¸€æ¡è®°å½•
åˆ—ï¼šä¸€ä¸ªå­—æ®µ
ä¸»é”®ï¼šèƒ½å¤Ÿå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•çš„å­—æ®µ
å¤–é”®ï¼šå…¶ä»–è¡¨çš„ä¸»é”®(å¤–æ¥çš„ä¸»é”®)
Oracle
DB2
SQLServer
MySQL
```
######å­¦ç”Ÿè¡¨

```
å­¦å·	å§“å	æ€§åˆ« å‡ºç”Ÿæ—¥æœŸ å®¶åº­ä½å€
1001	éª†æ˜Š	ç”·	1980-11-28 å››å·æˆéƒ½
1002 ç‹å¤§é”¤ å¥³	1990-1-1 å››å·è‡ªè´¡
SQL
	DDL - æ•°æ®å®šä¹‰è¯­è¨€ create / drop / alter
	DML - æ•°æ®æ“ä½œè¯­è¨€ insert / delete / update
	DQL - æ•°æ®æŸ¥è¯¢è¯­è¨€ select
	DCL - æ•°æ®æ§åˆ¶è¯­è¨€ grant / revoke
```
######é›†åˆè®º

```
å…³ç³»ä»£æ•°
æ•°æ®åº“è®¾è®¡ - ERå›¾(å®ä½“å…³ç³»å›¾)
ä¸€å¯¹ä¸€ ---> äººå’Œèº«ä»½è¯
ä¸€å¯¹å¤š --->  éƒ¨é—¨å’Œå‘˜å·¥ã€ç”¨æˆ·å’Œè®¢å•
å¤šå¯¹å¤š ---> è®¢å•å’Œå•†å“ã€è¯»è€…å’Œå›¾ä¹¦```

```
--åˆ é™¤è¡¨
drop table TbStudent;

--åˆ›å»ºè¡¨
create table TbStudent
(
stuid integer primary key, --å­¦å·
stuname varchar(20) not null, -- å§“å
stusex char(1) default 'ç”·', --æ€§åˆ«
stuaddr varchar(50) --å®¶åº­ä½å€
);

--ä¿®æ”¹è¡¨
alter table TbStudent add stubirth date;

--æ’å…¥è®°å½•
insert into TbStudent values (1001, 'éª†æ˜Š', 'ç”·', 'å››å·æˆéƒ½', '1980-11-28');
insert into TbStudent (stuid, stuname) values (1002, 'ç‹å¤§é”¤');
insert into TbStudent (stuid, stuname) values (1003, 'ç‹å¤§é”¤');
insert into TbStudent (stuid, stuname, stusex, stubirth) values (1004, 'æè«æ„', 'å¥³', '1986-12-3');
insert into TbStudent values (1005, 'å¼ ä¸‰ä¸°', 'ç”·', 'å››å·æˆéƒ½', '1975-5-5');
insert into TbStudent values (1006, 'æäºŒç‹', 'å¥³', 'å››å·ç»µé˜³', '1988-6-6');
insert into TbStudent values (1007, 'ç‹ä¸½', 'å¥³', 'å››å·æˆéƒ½', '1992-2-2');

--åˆ é™¤æ•°æ®
delete from TbStudent where stuid=1003;
delete from TbStudent where stuname='ç‹å¤§é”¤';

--æ›´æ–°æ•°æ®
update TbStudent set stuaddr='å››å·ç»µé˜³', stubirth='1990-4-5' where stuid=1002;
update TbStudent set stuaddr='æ¹–å—é•¿æ²™' where stuid=1004;

--æŸ¥è¯¢æ‰€æœ‰è¡Œæ‰€æœ‰åˆ—
select * from TbStudent;

--æŠ•å½±æ“ä½œ
select stuname, stusex from TbStudent;
--åœ¨æŠ•å½±æ—¶åˆ«å
select stuname as å§“å, stusex as æ€§åˆ« from TbStudent;

--æ•°æ®ç­›é€‰
select * from TbStudent where stusex='ç”·';
select * from TbStudent where stusex='ç”·' and stuaddr='å››å·æˆéƒ½';
select * from TbStudent where stusex='ç”·' or stuaddr='å››å·æˆéƒ½';
select * from TbStudent where stubirth between '1985-1-1' and '1989-12-31';
select * from TbStudent where stubirth<'1980-1-1';
select * from TbStudent where stuname like 'ç‹%';
select * from TbStudent where stuname like 'ç‹_';
select * from TbStudent where stuname like 'ç‹__';
select * from TbStudent where stuname like '%ç‹%';

--æ’åº
select * from TbStudent order by stubirth asc;
select * from TbStudent order by stubirth desc;
select * from TbStudent order by stusex, stuid desc; 

--åˆ†ç»„
select stusex, count(stusex) from TbStudent group by stusex;
select stuaddr, count(stuaddr) from TbStudent group by stuaddr;
select stuaddr å®¶åº­ä½å€, count(stuaddr) as æ€»äººæ•° from TbStudent group by stuaddr order by æ€»äººæ•°;
select count(stuid) from TbStudent;

--èšåˆå‡½æ•°/åˆ†ç»„å‡½æ•°
count
max
min
avg
sum

select min(stubirth) from TbStudent;

--å­æŸ¥è¯¢(æŠŠä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ªæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†æ¥ä½¿ç”¨)
select stuname, stubirth from TbStudent where stubirth=(select min(stubirth) from TbStudent);
select stuname, stubirth from TbStudent where stubirth=(select max(stubirth) from TbStudent);

--è¿æ¥æŸ¥è¯¢
	---> å†…è¿æ¥
	---> å¤–è¿æ¥  ---> å·¦å¤–è¿æ¥
							---> å³å¤–è¿æ¥
							---> å…¨å¤–è¿æ¥
pragma foreign_key=on;


-- ä¸€å¯¹ä¸€å¤–é”®å…³è”
create table TbPerson
(
pid integer primary key,
pname varchar(20) not null,
ptel char(11) not null,
paddr varchar(50)
);

create table TbIdCard
(
cid char(18) primary key,
corg varchar(50) not null,
cvaldate date not null,
pid integer unique references TbPerson(pid)
);

--ä¸€å¯¹å¤šå¤–é”®å…³è”
create table TbDept
(
deptno tinyint primary key,
dname varchar(10) not null,
dloc varchar(20) not null
);

insert into TbDept values (10, 'ä¼šè®¡éƒ¨', 'åŒ—äº¬');
insert into TbDept values (20, 'ç ”å‘éƒ¨', 'æˆéƒ½');
insert into TbDept values (30, 'é”€å”®éƒ¨', 'é‡åº†');
insert into TbDept values (40, 'è¿ç»´éƒ¨', 'æ·±åœ³');

create table TbEmp
(
empno int primary key,
ename varchar(20) not null,
job varchar(10) not null,
mgr int,
sal int not null,
dno tinyint,
foreign key (dno) references TbDept(deptno)
);

insert into TbEmp values (7800, 'å¼ ä¸‰ä¸°', 'æ€»è£', null, 9000, 20);
insert into TbEmp values (2056, 'ä¹”å³°', 'åˆ†æå¸ˆ', 7800, 5000, 20);
insert into TbEmp values (3088, 'æè«æ„', 'è®¾è®¡å¸ˆ', 2056, 3500, 20);
insert into TbEmp values (3211, 'å¼ æ— å¿Œ', 'ç¨‹åºå‘˜', 2056, 3200, 20);
insert into TbEmp values (3233, 'ä¸˜å¤„æœº', 'ç¨‹åºå‘˜', 2056, 3400, 20);
insert into TbEmp values (3251, 'å¼ ç¿ å±±', 'ç¨‹åºå‘˜', 2056, 4000, 20);
insert into TbEmp values (5566, 'å®‹è¿œæ¡¥', 'ä¼šè®¡å¸ˆ', 7800, 4000, 10);
insert into TbEmp values (5234, 'éƒ­é–', 'å‡ºçº³', 5566, 2000, 10);
insert into TbEmp values (3344, 'é»„è“‰', 'é”€å”®ä¸»ç®¡', 7800, 3000, 30);
insert into TbEmp values (1359, 'èƒ¡ä¸€åˆ€', 'é”€å”®å‘˜', 3344, 1800, 30);
insert into TbEmp values (4466, 'è‹—äººå‡¤', 'é”€å”®å‘˜', 3344, 2500, 30);
insert into TbEmp values (3244, 'æ¬§é˜³é”‹', 'ç¨‹åºå‘˜', 3088, 3200, 20);
insert into TbEmp values (3577, 'æ¨è¿‡', 'ä¼šè®¡', 5566, 2200, 10);
insert into TbEmp values (3588, 'æœ±ä¹çœŸ', 'ä¼šè®¡', 5566, 2500, 10);

1.select  ename,sal from TbEmp where sal=(select max(sal) from TbEmp);
5.select ename,sal from TbEmp where sal >(select avg(sal) from TbEmp);
1.select ename, sal, t1.dno from TbEmp as t1,
 (select dno, max(sal) as maxSal from TbEmp group by dno) as t2 where     t1.dno=t2.dno and t1.sal = t2.maxSal;
```

##FMDBçš„æ ¸å¿ƒAPI
	
	FMDatabase --- ä»£è¡¨æ•°æ®åº“
	FMResultSet --- ä»£è¡¨æ“ä½œæŸ¥è¯¢ç»“æœçš„æ¸¸æ ‡
	FMDatabaseAdditions --- å¯¹FMDatabaseç±»æ‰©å±•çš„Category
	FMDatabasePool --- æ•°æ®åº“è¿æ¥æ± æ”¯æŒç±»
	FMDatabaseQueue --- æ•°æ®åº“å¤šçº¿ç¨‹æ“ä½œæ”¯æŒç±»
	
â€‹```Objective-C
// åˆ›å»ºæ•°æ®åº“
- (void) createDb {
    NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/test.db"];
    NSLog(@"%@", path);
    self.db = [[FMDatabase alloc] initWithPath:path];
    if([self.db open]) {
        [self createTable];
    }
    else {
        NSLog(@"åˆ›å»ºæ•°æ®åº“å¤±è´¥!");
    }
}

// åˆ›å»ºè¡¨
- (void) createTable {
    NSString *sql = @"create table if not exists tb_user (username varchar(20) primary key, password varchar(20) not null, email varchar(50));";
    if([self.db executeUpdate:sql]) {
        [self insertData];
    }
    else {
        NSLog(@"åˆ›å»ºç”¨æˆ·è¡¨å¤±è´¥!");
    }
}

// æ’å…¥æ•°æ®
- (void) insertData {
    NSString *sql = @"insert into tb_user values (?,?,?);";
    if([self.db executeUpdate:sql, @"jackfrued", @"123456", @"jackfrued@126.com"]) {
        
    }
    else {
        NSLog(@"æ’å…¥æ•°æ®å¤±è´¥!");
    }
}

// æ˜¾ç¤ºè¡¨ä¸­çš„è®°å½•
- (void) showRecords {
    NSString *path = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/test.db"];
    self.db = [[FMDatabase alloc] initWithPath:path];
    if([self.db open]) {
        NSString *sql = @"select * from tb_user";
        FMResultSet *rs = [self.db executeQuery:sql];
        NSLog(@"%d", rs.next);
        while([rs next]) {
            NSLog(@"Username: %@", [rs stringForColumn:@"username"]);
            NSLog(@"Password: %@", [rs stringForColumn:@"password"]);
            NSLog(@"Email: %@", [rs stringForColumn:@"email"]);
        }
        
        [self clearData];
    }
    else {
        NSLog(@"åˆ›å»ºæ•°æ®åº“å¤±è´¥!");
    }
}

- (void) clearData {
    NSString *sql = @"delete from tb_user";
    if([self.db executeUpdate:sql]) {
        NSLog(@"æ¸…ç†æ•°æ®æˆåŠŸ!!!");
    }
}```

```
@interface ViewController () <UITableViewDataSource, UITableViewDelegate> {
    UITableView *myTableView;
    NSMutableArray *dataArray;
    FMDatabase *db;
}

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];

    self.title = @"éƒ¨é—¨ä¿¡æ¯";

    myTableView = [[UITableView alloc] initWithFrame:self.view.bounds style:UITableViewStylePlain];
    [self.view addSubview:myTableView];

    myTableView.dataSource = self;
    myTableView.delegate = self;

    [self loadDataModel];

    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemAdd target:self action:@selector(addDept:)];
    self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@"ç¼–è¾‘" style:UIBarButtonItemStylePlain target:self action:@selector(editDept:)];

    [self registerObserver];
    }

- (void) editDept:(UIBarButtonItem *) sender {
    if ([myTableView isEditing]) {
        [myTableView setEditing:NO animated:YES];
        [sender setTitle:@"ç¼–è¾‘"];
    }
    else {
        [myTableView setEditing:YES animated:YES];
        [sender setTitle:@"å®Œæˆ"];
    }
    }

- (void) registerObserver {
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notificationReceived:) name:@"AddDeptNotification" object:nil];
    }

- (void) notificationReceived:(NSNotification *) sender {
    [dataArray addObject:sender.object];
    [myTableView insertRowsAtIndexPaths:@[[NSIndexPath indexPathForRow:dataArray.count - 1 inSection:0]] withRowAnimation:UITableViewRowAnimationRight];
    }

- (void) addDept:(id) sender {
    CDDeptViewController *deptVC = [[CDDeptViewController alloc] init];
    [self.navigationController pushViewController:deptVC animated:YES];
    }

- (void) loadDataModel {
    if (!dataArray) {
        dataArray = [NSMutableArray array];
    }

    // ä»åµŒå…¥å¼æ•°æ®åº“sqlite3ä¸­åŠ è½½æ•°æ®
    NSString *filePath = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/company.db"];
    // åˆ›å»ºæ•°æ®åº“å¯¹è±¡
    db = [FMDatabase databaseWithPath:filePath];
    if (db && [db open]) {
        NSString *sql = @"select deptno, dname, dloc, total from TbDept as t1 left outer join (select dno, count(dno) as total from TbEmp group by dno) as t2 on t1.deptno=t2.dno";
        // æ‰§è¡ŒæŸ¥è¯¢çš„SQLè¯­å¥è·å¾—ç»“æœé›†(æ¸¸æ ‡)
        FMResultSet *rs = [db executeQuery:sql];
        while ([rs next]) {
            // å¯¹æŸ¥è¯¢ç»“æœçš„è¡Œè¿›è¡Œè¿­ä»£ä»è¡Œä¸­å–å‡ºæ•°æ®
            // æ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªéƒ¨é—¨çš„è®°å½•
            CDDept *model = [[CDDept alloc] init];
            
            // é€šè¿‡ç»“æœé›†å¯¹è±¡çš„æ–¹æ³•å–å‡ºæŒ‡å®šçš„åˆ—çš„æ•°æ®
            model.no = [rs intForColumn:@"deptno"];
            model.name = [rs stringForColumn:@"dname"];
            model.location = [rs stringForColumn:@"dloc"];
            model.total = [rs intForColumn:@"total"];
            
            // å°†æ¨¡å‹æ·»åŠ åˆ°æ•°ç»„ä¸­
            [dataArray addObject:model];
        }
        // åˆ·æ–°è¡¨æ ¼è§†å›¾
        [myTableView reloadData];
    }
    else {
        NSLog(@"åˆ›å»ºæˆ–æ‰“å¼€æ•°æ®åº“å¤±è´¥!!!");
    }
    }

- (NSInteger) tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return dataArray.count;
    }

- (UITableViewCell *) tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"CELL"];

    if (!cell) {
        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@"CELL"];
    }

    CDDept *model = dataArray[indexPath.row];

    cell.accessoryType = model.total > 0? UITableViewCellAccessoryDisclosureIndicator: UITableViewCellAccessoryNone;

    cell.textLabel.text = [NSString stringWithFormat:@"%@(%ld)", model.name, model.total];

    return cell;
    }

- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath {
    if (editingStyle == UITableViewCellEditingStyleDelete) {
        CDDept *model = dataArray[indexPath.row];
        if (model.total == 0) {
            if (db && [db open]) {
                // executeUpdate --- å¢åˆ æ”¹
                // executeQuery --- æŸ¥è¯¢
                if ([db executeUpdate:@"delete from TbDept where deptno=?", @(model.no)]) {
                    [dataArray removeObject:model];
                    // [dataArray removeObjectAtIndex:indexPath.row];
                    [myTableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationLeft];
                }
                else {
                    NSLog(@"åˆ é™¤éƒ¨é—¨å¤±è´¥!!!");
                }
            }
            else {
                NSLog(@"åˆ›å»ºæˆ–æ‰“å¼€æ•°æ®åº“å¤±è´¥!!!");
            }
        }
    }
    }

- (void) tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    CDDept *model = dataArray[indexPath.row];
    // if (model.total > 0) {
        // å¦‚æœéƒ¨é—¨äººæ•°å¤§äº0å°±å¯¼èˆªåˆ°æŸ¥çœ‹å‘˜å·¥åå•çš„è§†å›¾æ§åˆ¶å™¨
        CDEmpViewController *empVC = [[CDEmpViewController alloc] init];
        empVC.model = model;
        [self.navigationController pushViewController:empVC animated:YES];
    // }
    }

- (void)dealloc {
    [[NSNotificationCenter defaultCenter] removeObserver:self];
    }

- (IBAction)okButtonClicked:(id)sender {
    NSString *name = [_nameLabel.text trim];
    NSString *location = [_locationLabel.text trim];
    // ä»åµŒå…¥å¼æ•°æ®åº“sqlite3ä¸­åŠ è½½æ•°æ®
    NSString *filePath = [NSHomeDirectory() stringByAppendingPathComponent:@"Documents/company.db"];
    // åˆ›å»ºæ•°æ®åº“å¯¹è±¡
    FMDatabase *db = [FMDatabase databaseWithPath:filePath];
    if (db && [db open]) {
        FMResultSet *rs = [db executeQuery:@"select max(deptno) as maxDno from TbDept"];
        if ([rs next]) {
            int no = [rs intForColumn:@"maxDno"];
            no += 10;
            NSString *sql = @"insert into TbDept values (?,?,?)";
            if ([db executeUpdate:sql, @(no), name, location]) {
                CDDept *model = [[CDDept alloc] init];
                model.no = no;
                model.name = name;
                model.location = location;
                NSNotification *note = [[NSNotification alloc] initWithName:@"AddDeptNotification" object:model userInfo:nil];
                [[NSNotificationCenter defaultCenter] postNotification:note];
                [self.navigationController popViewControllerAnimated:YES];
            }
            else {
                NSLog(@"æ·»åŠ æ–°éƒ¨é—¨å¤±è´¥!!!");
            }
        }
    }
    else {
        NSLog(@"åˆ›å»ºæˆ–æ‰“å¼€æ•°æ®åº“å¤±è´¥!!!");
    }
    }```